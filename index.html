<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>دعوة ملكة لمار + وليد كادو</title>
  <style>
    :root{--accent:#b33b8a;--muted:#666}
    body{font-family: 'Tahoma', Arial, sans-serif;background:#f7f5f8;color:#222;padding:24px}
    .card{max-width:760px;margin:18px auto;background:#fff;border-radius:14px;box-shadow:0 6px 20px rgba(0,0,0,0.08);overflow:hidden}
    header{padding:28px 30px;border-bottom:1px solid #f0ecf2;background:linear-gradient(90deg,rgba(179,59,138,0.06),rgba(179,59,138,0.02))}
    h1{margin:0;font-size:22px;color:var(--accent)}
    .subtitle{color:var(--muted);margin-top:6px}
    .content{padding:22px}
    .info{display:flex;gap:18px;flex-wrap:wrap;margin-bottom:18px}
    .info .box{flex:1;min-width:180px;background:#fff;border-radius:10px;padding:14px;border:1px solid #f0edf2}
    .info strong{display:block;font-size:14px;margin-bottom:8px}
    .actions{display:flex;gap:12px;flex-wrap:wrap}
    button{cursor:pointer;padding:12px 16px;border-radius:10px;border:0;background:var(--accent);color:#fff;font-weight:600}
    button.secondary{background:#efefef;color:#333}
    .guest-list{margin-top:18px}
    .guest-list h3{margin:0 0 8px 0}
    ul{list-style:none;padding:0;margin:0}
    li{padding:10px 12px;border-radius:8px;border:1px solid #f0edf2;margin-bottom:8px;background:#fff;display:flex;justify-content:space-between}
    .status.accept{color:green;font-weight:700}
    .status.decline{color:#d9534f;font-weight:700}
    .small{font-size:13px;color:var(--muted)}
    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;padding:20px}
    .modal{background:#fff;padding:18px;border-radius:12px;max-width:440px;width:100%}
    .modal h2{margin:0 0 8px 0}
    .field{margin-top:12px}
    input[type=text]{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e4e8}
    .row{display:flex;gap:10px;margin-top:12px}
    .csv-link{display:inline-block;margin-top:12px}
    @media (max-width:520px){header{padding:18px} .content{padding:16px}}
  </style>
</head>
<body>
  <div class="card" role="application">
    <header>
      <h1>دعوة لحضور ملكة لمار + وليد كادو</h1>
      <div class="subtitle">يسرّنا دعوتكم لمشاركتنا فرحتنا — الجمعة 01/01/2026 — قاعة أصيلة · جدة · حي أبحر الشمالية · الساعة 9:00 م</div>
    </header>

    <div class="content">
      <div class="info">
        <div class="box">
          <strong>العروس</strong>
          لمار
        </div>
        <div class="box">
          <strong>العريس</strong>
          وليد كادو
        </div>
        <div class="box">
          <strong>التاريخ / الوقت</strong>
          01/01/2026 — 9:00 مساءً
        </div>
      </div>

      <p class="small">فضلاً اضغط "أقبل الحضور" أو "أعتذر عن الحضور" ثم اكتب اسمك في النافذة التي ستفتح. سيتم تخزين الرد هنا ويمكنك تنزيل قائمة الضيوف لاحقاً.</p>

      <div class="actions">
        <button id="acceptBtn">✅ أقبل الحضور</button>
        <button id="declineBtn" class="secondary">❌ أعتذر عن الحضور</button>
        <button id="downloadCsv" class="secondary">⬇️ تنزيل CSV للردود</button>
      </div>

      <div class="guest-list" aria-live="polite">
        <h3>قائمة الردود</h3>
        <ul id="responses"></ul>
      </div>

      <div class="small" style="margin-top:12px">ملاحظة: يمكن تعديل جزء الإرسال عبر الإنترنت بتغيير قيمة `WEBHOOK_URL` داخل كود الجافاسكربت لإرسال الردود إلى خدمة استلام (مثل Google Apps Script أو Formspree).</div>
    </div>
  </div>

  <!-- Modal -->
  <div id="modal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" id="modalContent">
      <h2 id="modalTitle">تأكيد الحضور</h2>
      <p id="modalText" class="small">اكتب اسمك للتأكيد:</p>

      <div class="field">
        <label for="guestName" class="small">الاسم</label>
        <input id="guestName" type="text" placeholder="اكتب اسمك هنا" />
      </div>

      <div class="row">
        <button id="submitBtn">إرسال</button>
        <button id="cancelBtn" class="secondary">إلغاء</button>
      </div>
    </div>
  </div>

  <script>
    // === اضبط هنا رابط الويب هوك الخاص بك إن وُجد (مثلاً Google Apps Script URL أو Formspree) ===
    const WEBHOOK_URL = ""; // ضع رابط الاستقبال هنا أو اتركه فارغاً للعمل محلياً

    // عناصر DOM
    const acceptBtn = document.getElementById('acceptBtn');
    const declineBtn = document.getElementById('declineBtn');
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modalTitle');
    const modalText = document.getElementById('modalText');
    const guestName = document.getElementById('guestName');
    const submitBtn = document.getElementById('submitBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const responsesEl = document.getElementById('responses');
    const downloadCsv = document.getElementById('downloadCsv');

    // بيانات الردود في الذاكرة (يمكن حفظها في localStorage)
    let responses = JSON.parse(localStorage.getItem('rsvp_responses') || '[]');
    let currentChoice = null; // 'accept' أو 'decline'

    function renderResponses(){
      responsesEl.innerHTML = '';
      if(responses.length === 0){
        responsesEl.innerHTML = '<li class="small">لا توجد ردود حتى الآن.</li>';
        return;
      }
      responses.forEach(r=>{
        const li = document.createElement('li');
        li.innerHTML = `<span>${escapeHtml(r.name)}</span><span class="status ${r.choice}">${r.choice === 'accept' ? 'حضر' : 'اعتذر'}</span>`;
        responsesEl.appendChild(li);
      });
    }

    function openModal(choice){
      currentChoice = choice;
      modalTitle.textContent = choice === 'accept' ? 'أقبل الحضور' : 'أعتذر عن الحضور';
      modalText.textContent = 'اكتب اسمك للتأكيد:';
      guestName.value = '';
      modal.style.display = 'flex';
      modal.setAttribute('aria-hidden','false');
      guestName.focus();
    }

    function closeModal(){
      modal.style.display = 'none';
      modal.setAttribute('aria-hidden','true');
    }

    acceptBtn.addEventListener('click', ()=> openModal('accept'));
    declineBtn.addEventListener('click', ()=> openModal('decline'));
    cancelBtn.addEventListener('click', closeModal);

    submitBtn.addEventListener('click', ()=>{
      const name = guestName.value.trim();
      if(!name){
        alert('الرجاء كتابة الاسم');
        guestName.focus();
        return;
      }
      const entry = {name, choice: currentChoice, date: new Date().toISOString()};
      responses.push(entry);
      localStorage.setItem('rsvp_responses', JSON.stringify(responses));
      renderResponses();
      closeModal();

      // إرسال للويب هوك إن وجد
      if(WEBHOOK_URL){
        fetch(WEBHOOK_URL, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({event: 'rsvp', payload: entry})
        }).catch(err=>console.warn('Webhook send failed', err));
      }
    });

    // تنزيل CSV
    downloadCsv.addEventListener('click', ()=>{
      if(responses.length === 0){ alert('لا توجد ردود لتنزيلها'); return; }
      const header = ['الاسم','حالة الحضور','تاريخ الارسال'];
      const rows = responses.map(r=>[r.name, r.choice === 'accept' ? 'حضر' : 'اعتذر', r.date]);
      const csvContent = [header, ...rows].map(r=>r.map(cell=>`"${String(cell).replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob = new Blob([csvContent], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'rsvp_responses.csv';
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    });

    // حماية بسيطة ضد XSS عند العرض
    function escapeHtml(s){
      return s.replace(/[&<>\"']/g, function(c){
        return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c];
      });
    }

    // Render init
    renderResponses();

    // إغلاق المودال بالضغط خارجه
    modal.addEventListener('click', (e)=>{ if(e.target === modal) closeModal(); });
  </script>
</body>
</html>
